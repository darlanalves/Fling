!function(){var e=angular.module("fling",["ui.router","assert","defer","ngSanitize"]).config(["assertProvider",function(e){e.enableThrow(!0)}]);!function(){var t="trending",n="search";e.constant("TRENDING",t).constant("SEARCH",n).run(["$rootScope","UserService",function(e,r){e.GENDER_MALE=r.GENDER_MALE,e.GENDER_FEMALE=r.GENDER_FEMALE,e.TRENDING=t,e.SEARCH=n}])}(),e.config(["$stateProvider",function(e){var t={app:{url:"",templateUrl:"/layout/layout.html"},"app.signup":{url:"/app/signup",templateUrl:"/user/signup.html",controller:"User/SignupController"},"app.my-profile":{url:"/app/me",templateUrl:"/user/profile.html",controller:"User/ProfileController"},"app.profile":{url:"/app/profile/:uid",templateUrl:"/user/profile.html",controller:"User/ProfileController"},"app.search":{url:"/app/search?name&gender&minHeight&maxHeight&height",templateUrl:"/people/search.html",controller:"People/SearchController"},"app.trending":{url:"/app/trending",templateUrl:"/people/trending.html",controller:"People/TrendingController"}};angular.forEach(t,function(t,n){e.state(n,t)})}]),e.controller("HeaderController",["$scope","$state","SEARCH",function(e,t,n){e.searchByName=function(e){e&&t.go("app.search",{name:e,tab:n},{reload:!0})}}]),e.controller("MenuController",["$scope","UserService",function(e,t){e.hasProfileActive=function(){return t.hasProfileActive()}}]),e.directive("controlGroup",function(){return{restrict:"C",compile:function(e,t){"required"in t&&["input","select","textarea"].forEach(function(t){e.find(t).attr("ng-required","true")})}}}),e.directive("form",function(){return{restrict:"C",link:function(e,t){setTimeout(function(){for(var e,n=t.find("input, textarea, select, button"),r=0,i=n.length;i>r;r++)if(e=angular.element(n[r]),e.attr("autofocus")){n[r].focus();break}})}}}),e.directive("person",function(){return{restrict:"A",replace:!0,scope:{person:"="},template:'<div class="person"><a class="name" ng-bind="person.name" ng-click="selectPerson()"></a><div class="gender" ng-bind="person.gender | gender" ng-click="selectGender()"></div><div class="height" ng-bind="person.height" ng-click="selectHeight()"></div><div class="views" ng-bind="person.views"></div><span></span></div>',controller:"PersonController"}}),e.controller("PersonController",["$scope",function(e){e.selectGender=function(){e.$emit("filter.selected","gender",e.$eval("person.gender"))},e.selectHeight=function(){e.$emit("filter.selected","minHeight",e.$eval("person.height"))},e.selectPerson=function(){e.$emit("filter.selected","uid",e.$eval("person.uid"))}}]),e.directive("radioGroup",function(){function e(){return"input--radio-"+t++}var t=1;return{restrict:"C",link:function(t,n){for(var r,i,o,a=n.find("input"),l=a.length,c=0;l>c;c++)i=angular.element(a[c]),o=i.next(),o.attr("for")||(r=e(),o.attr("for",r),i.attr("id",r))}}}),e.directive("searchBox",function(){function e(e,t){var n=null;return function(){n||(n=setTimeout(function(){n=!1,e()},t))}}return{template:'<div ng-class="{\'with-button\': withButton}"><input type="text" ng-attr-tabindex="{{tabindex}}" ng-class="{mini:mini}" ng-model="search.keywords" placeholder="{{placeholder}}" ng-enter="doSearch()" class="input" /><button ng-if="withButton" class="primary button" ng-click="doSearch()" ng-bind="actionText" type="submit" ng-class="{mini:mini}"></button></div>',restrict:"C",scope:{onsearch:"&",onchange:"&",placeholder:"@",actionText:"@",tabindex:"@"},link:function(t,n,r){t.search={};var i=t.onchange(),o=t.onsearch(),a=e(function(){i&&i(t.search.keywords)},r.delay||200);t.$watch("search.keywords",a),t.mini="mini"in r,t.withButton="button"in r,t.doSearch=function(){o&&o(t.search.keywords)}}}}),e.directive("tabset",function(){return{restrict:"C",transclude:!0,scope:{onselect:"&"},template:'<div tab-buttons="$parent.labels" active="$parent.tabs.active" onselect="$parent.openTab($tab)"></div><div ng-transclude></div>',controller:["$scope",function(e){function t(e){for(var t=0,r=n.length;r>t;t++)if(e===n[t]){i(t);break}}var n=e.tabs=[],r=e.labels=[];n.active=0,this.register=function(i,o){n.push(i),r.push(o.label||""),"active"in o&&(n.active=n.length-1,o.active&&e.$watch(o.active,function(e){e&&t(i)}))};var i=e.openTab=this.openTab=function(t){n.forEach(function(r,i){i===t?(r.addClass("active"),n.active=t,e.onselect(e,{tab:r})):r.removeClass("active")})};setTimeout(function(){e.openTab(n.active?n.active:0)}),e.$on("$destroy",function(){n.length=0})}]}}).directive("tabButtons",["$parse",function(e){return{replace:!0,scope:{},template:'<div class="tab-buttons"><span class="tab-button" ng-class="{active: isActive($index)}" ng-repeat="tab in tabs track by $index" ng-click="selectTab($index)">{{tab}}</span></div>',link:function(t,n,r){t.tabs=t.$eval(r.tabButtons);var i=e(r.onselect)(t);t.isActive=function(n){return+e(r.active)(t)==n},t.selectTab=function(e){i&&i(e)}}}}]).directive("tab",function(){return{restrict:"C",require:"?^tabset",link:function(e,t,n,r){r.register(t,n)}}}),e.directive("tagBar",function(){return{restrict:"A",scope:{tags:"=tagBar"},template:'<ul class="tag-bar"><li class="tag" ng-repeat="tag in tags"><span>{{tag.label}}</span> <a ng-click="removeTag(tag)">&times;</a></li></ul>',link:function(e){e.removeTag=function(t){e.$emit("tag.remove",t)}}}}),e.controller("People/SearchController",["$scope","$state","$stateParams","UserService","SearchFilter",function(e,t,n,r,i){function o(){var e={};return angular.forEach(l.$filter,function(t,n){0!==+t&&null!==t&&(e[n]=t)}),e}function a(){var n=o();r.findAll(l).then(function(r){e.results=r,t.transitionTo(t.current.name,n,{inherit:!1})},function(e){console.log(e)})}var l=e.filters=new i;e.$on("filter.changed",a),e.$on("filter.selected",function(e,n,r){return"uid"===n?void t.go("app.profile",{uid:r}):(l.setFilter(n,r),void a())}),e.updateSearch=a,e.search={minHeight:0|+n.minHeight,maxHeight:0|+n.maxHeight,height:0|+n.height,name:n.name||"",gender:n.gender||null},l.setFilters(e.search),a()}]),e.controller("People/TrendingController",["$scope","UserService","SearchFilter",function(e,t,n){var r=new n;r.setSorting("views",n.DESC),t.findAll(r).then(function(t){e.results=t})}]),e.directive("searchTags",["genderFilter",function(e){return{scope:{filters:"="},template:'<div tag-bar="searchTags"></div>',link:function(t){function n(){r.length=0,+i.minHeight&&r.push({label:"Altura mínima: "+i.minHeight,name:"minHeight"}),+i.maxHeight&&r.push({label:"Altura máxima: "+i.maxHeight,name:"maxHeight"}),+i.height&&r.push({label:"Altura: "+i.height,name:"height"}),i.name&&r.push({label:"Nome: "+i.name,name:"name"}),i.gender&&r.push({label:"Sexo: "+e(i.gender),name:"gender"})}var r=t.searchTags=[],i=t.filters.$filter;t.$on("tag.remove",function(e,r){t.filters.unsetFilter(r.name),n(),t.$emit("filter.changed")}),n()}}}]),e.factory("SearchFilter",function(){function e(){return!this instanceof e?new e:(this.clearFilters(),void this.clearSorting())}return e.prototype={constructor:e,ASC:"asc",DESC:"desc",clearFilters:function(){this.$filter={}},clearSorting:function(){this.$sort=null},setFilters:function(e){this.$filter=e},setFilter:function(e,t){this.$filter[e]=t},unsetFilter:function(e){this.$filter[e]=null,delete this.$filter[e]},setSorting:function(e,t){this.$sort={name:e,direction:t||this.ASC}},setPageParams:function(e,t){this.$page=Math.abs(0|e),this.$limit=0|t},getParams:function(){return{filter:angular.copy(this.$filter),sort:angular.copy(this.$sort),page:this.$page,limit:this.$limit}}},e}),e.factory("UserService",["$http","assert","is","SearchFilter","rejected",function(e,t,n,r,i){var o=null;return{GENDER_MALE:"male",GENDER_FEMALE:"female",hasProfileActive:function(){return null!==o},getActiveProfile:function(){return o},findOne:function(t){return t?e.get("/user/"+t).then(function(e){return e.data}):i(new Error("Identificação de usuário inválida"))},findAll:function(n){try{t(n instanceof r,"Parâmetros de busca inválidos")}catch(o){return i(o)}return e.get("/user",{params:n.getParams()}).then(function(e){return e.data})},create:function(t){try{n.number(+t.uid,"CPF inválido"),n.number(+t.height,"Altura inválida"),n.not.empty(t.name,"Nome inválido"),n.not.empty(t.gender,"Sexo não informado")}catch(r){return i(r)}return e.post("/user",t).then(function(){return o=t})}}}]),e.filter("gender",["UserService",function(e){return function(t){return t===e.GENDER_MALE?"masculino":t===e.GENDER_FEMALE?"feminino":""}}]),e.controller("User/ProfileController",["$scope","$state","$stateParams","UserService",function(e,t,n,r){"app.my-profile"===t.current.name?e.profile=r.getActiveProfile():r.findOne(n.uid).then(function(t){e.profile=t},function(e){console.log(e)})}]),e.controller("User/SignupController",["$scope","$state","UserService",function(e,t,n){e.user={},e.saveUser=function(r){r&&r.$invalid||n.create(e.user).then(function(){t.go("app.my-profile")},function(e){console.log(e)})}}])}();